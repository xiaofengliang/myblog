---
title: 二营长的意大利炮
date: 2019-11 21:18:59
tags:
excerpt: arduino
photos: https://i.loli.net/2020/05/04/bkBA7IoEhx4cW8a.jpg
---
 # 一、制作思路

这次选用的材料有：舵机 * 3，木板，arduino UNO，红外模块；

舵机的控制需要调用 <Servo.h> 库，使用顺序是：

1. 声明一个或多个Servo.myservo1, Servo.myservo2, Servo.myservo3,;

2. 初始化每个servo的引脚，myservo.attach(pin);

3. 赋值myervo.write(val);

这就是这次我们选用的舵机的核心调用逻辑；

![微信图片_20191118232902.jpg](https://i.loli.net/2020/05/04/3HIVgcEsf5v6eCq.jpg)

而红外模块的调用需要调用<IRremote.h>, 使用顺序是：

1. 声明红外模块的对象IRrecv irrecv（PIN）;

2. 启动红外模块 irrecv.enableIRIn();

3. 接受信号并打印16进制的信号值；

4. 将信号值作为判断依据来实现控制；

# 二、程序编写





这次的控制由以下逻辑实现：

1. 设置3个舵机分别控制炮台的水平旋转，竖直旋转，和发射开关；

2. 用红外遥控来对舵机进行控制，这里我们使用手机软件也可以发射红外信号；

3. 4个按键分别对应不同的效果。

4. 每次按键可以让红外模块收到一个值，这个值可以改变程序中一个虚拟的状态量（flag），在让程序判断这个状态的存在，可以实现每次按键固定升高一个角度，而不是循环一直不断得加。

# 三、模型制作

![微信图片_20191118232715.jpg](https://i.loli.net/2020/05/04/mDfkciv9uLQ1JFM.jpg)

![微信图片_20191118232724.jpg](https://i.loli.net/2020/05/04/2tljbY5e38qapVL.jpg)

![微信图片_20191118232715.jpg](https://i.loli.net/2020/05/04/mDfkciv9uLQ1JFM.jpg)


![微信图片_20191118232930.jpg](https://i.loli.net/2020/05/04/ZcyBrbQNK1T6YtW.jpg)

![微信图片_20191118232923.jpg](https://i.loli.net/2020/05/04/bkBA7IoEhx4cW8a.jpg)

***视频观看链接 [二营长的意大利炮](https://www.bilibili.com/video/av76208160)***

```
#include <Servo.h>    //使用伺服电机类库
Servo myservo1;
Servo myservo2; 
Servo myservo3; //创建伺服对象以操作舵机

#include <IRremote.h>//使用红外遥控库
#include <IRremoteInt.h>
int val1= 60;
int val2= 0;
int val3= 0;
int RECV_PIN = 5, Led = 13;
IRrecv irrecv(RECV_PIN);
decode_results results;
unsigned long P1 = 0x4DB253AC, P2 = 0x4DB24BB4;
unsigned long P3 = 0x4DB2817E, P4 = 0x4DB201FE;
unsigned long P5 = 0x4DB29966, P6 = 0x4DB2837C;

long flag;
void setup() {
  Serial.begin(9600);
  myservo1.attach(9);
  myservo2.attach(10);
  myservo3.attach(11);//将引脚9.10的舵机附加到伺服对象
  myservo1.write(60);
  myservo2.write(90);
  myservo3.write(60);
  irrecv.enableIRIn();//红外模块

}
void loop() {
  //Serial.println(val);
  if (irrecv.decode(&results)) {
    if (results.value != -1) {
      Serial.println(results.value, HEX);
      if (results.value == P1) {
        flag = P1;
        val1 = val1 + 20;
      }
      if (results.value == P2) {
        flag = P2;
        val1 = val1 - 20;
      }
      if (results.value == P3) {
        flag = P3;
        val2 = 90;
      }
      if (results.value == P4) {
        flag = P4;
        val2 = 0;
      }
      if (results.value == P5) {
        flag = P5;
        val3 = val3 + 30;
      }
      if (results.value == P6) {
        flag = P6;
        val3 = val3 - 30;
      }
    }
    irrecv.resume();
  } //红外部分+舵机转动

  if ((flag == P1) && (val1 < 100)) {
    myservo1.write(val1);
    Serial.println("additon1");
    //Serial.println(val);
  }
  if ((flag == P2) && (val1 > 20)) {
    myservo1.write(val1);
    Serial.println("depress1");
    //Serial.println(val);
  }
  if (flag == P3) {
    myservo2.write(val2);
    Serial.println("additon2");
    //Serial.println(val);
  }
  if (flag == P4) {
    myservo2.write(val2);
    Serial.println("depress2");
    //Serial.println(val);
  }
 if (flag == P5) {
    myservo3.write(val3);
    Serial.println("additon3");
    //Serial.println(val);
  }
  if (flag == P6) {
    myservo3.write(val3);
    Serial.println("depress3");
    //Serial.println(val);
  }//红外部分+步进电机转动
}
```


